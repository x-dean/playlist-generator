# Playlist Generator Simple Configuration
# This file contains all configuration settings for the playlist generator

# =============================================================================
# EXTERNAL API CONFIGURATION
# =============================================================================
EXTERNAL_API_ENABLED=true

# MusicBrainz API (free, no key required)
MUSICBRAINZ_ENABLED=true
MUSICBRAINZ_USER_AGENT=playlista-simple/1.0
MUSICBRAINZ_RATE_LIMIT=1

# Last.fm API (requires API key)
LASTFM_ENABLED=true
LASTFM_API_KEY=${LASTFM_API_KEY}
LASTFM_RATE_LIMIT=2

# Discogs API (requires API key and user token)
DISCOGS_ENABLED=false
DISCOGS_API_KEY=${DISCOGS_API_KEY}
DISCOGS_USER_TOKEN=${DISCOGS_USER_TOKEN}
DISCOGS_RATE_LIMIT=1

# Spotify API (requires client ID and secret)
SPOTIFY_ENABLED=false
SPOTIFY_CLIENT_ID=${SPOTIFY_CLIENT_ID}
SPOTIFY_CLIENT_SECRET=${SPOTIFY_CLIENT_SECRET}
SPOTIFY_RATE_LIMIT=1

# Metadata enrichment settings
METADATA_ENRICHMENT_ENABLED=true
METADATA_ENRICHMENT_TIMEOUT=30
METADATA_ENRICHMENT_MAX_TAGS=15
METADATA_ENRICHMENT_RETRY_COUNT=3

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
LOG_LEVEL=INFO
LOG_FILE=logs/playlista.log
LOG_FORMAT=detailed
LOG_COLORED=false
LOG_BUFFERED=true
LOG_MAX_SIZE_MB=10
LOG_BACKUP_COUNT=5
LOG_CONSOLE_ENABLED=false
LOG_FILE_ENABLED=true
LOG_COLORED_OUTPUT=true
LOG_FILE_PREFIX=playlista
LOG_FILE_SIZE_MB=50
LOG_MAX_FILES=10
LOG_FILE_FORMAT=text
LOG_FILE_ENCODING=utf-8
LOG_CONSOLE_FORMAT=detailed
LOG_CONSOLE_DATE_FORMAT=%H:%M:%S
LOG_FILE_INCLUDE_EXTRA_FIELDS=true
LOG_FILE_INCLUDE_EXCEPTION_DETAILS=true
LOG_FUNCTION_CALLS_ENABLED=true
LOG_ENVIRONMENT_MONITORING=true
LOG_COLORED_OUTPUT=true
LOG_FILE_COLORED_OUTPUT=true
LOG_SIGNAL_HANDLING_ENABLED=true
LOG_SIGNAL_CYCLE_LEVELS=true

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
# Note: Music directory is fixed at /music (Docker path mapped from compose)
# Note: Failed directory is fixed at /app/cache/failed_dir (Docker path)
# Note: Database path is fixed at /app/cache/playlista.db (Docker path)
DB_PATH=/app/cache/playlista.db
DB_CACHE_DEFAULT_EXPIRY_HOURS=24
DB_CACHE_CLEANUP_FREQUENCY_HOURS=24
DB_CACHE_MAX_SIZE_MB=100
DB_CLEANUP_RETENTION_DAYS=30
DB_FAILED_ANALYSIS_RETENTION_DAYS=7
DB_STATISTICS_RETENTION_DAYS=90
DB_CONNECTION_TIMEOUT_SECONDS=30
DB_MAX_RETRY_ATTEMPTS=3
DB_BATCH_SIZE=100
DB_STATISTICS_COLLECTION_FREQUENCY_HOURS=24
DB_AUTO_CLEANUP_ENABLED=true
DB_AUTO_CLEANUP_FREQUENCY_HOURS=168
DB_BACKUP_ENABLED=true
DB_BACKUP_FREQUENCY_HOURS=168
DB_BACKUP_RETENTION_DAYS=30
DB_PERFORMANCE_MONITORING_ENABLED=true
DB_QUERY_TIMEOUT_SECONDS=60
DB_MAX_CONNECTIONS=10
DB_WAL_MODE_ENABLED=true
DB_SYNCHRONOUS_MODE=NORMAL

# =============================================================================
# FILE DISCOVERY CONFIGURATION
# =============================================================================
# Note: Music directory is fixed at /music (Docker path mapped from compose)
# Note: Failed directory is fixed at /app/cache/failed_dir (Docker path)
# Note: Database path is fixed at /app/cache/playlista.db (Docker path)
# Note: Exclude directories are fixed and not configurable
SUPPORTED_FORMATS=mp3,wav,flac,m4a,aac,ogg
RECURSIVE_SEARCH=true
MAX_FILE_SIZE_MB=500
MIN_FILE_SIZE_KB=10
EXCLUDE_PATTERNS=.DS_Store,Thumbs.db,*.tmp
INCLUDE_HIDDEN_FILES=false
FILE_DISCOVERY_TIMEOUT_SECONDS=300
FILE_DISCOVERY_BATCH_SIZE=1000
FILE_DISCOVERY_MAX_FILES=10000

# File Discovery Advanced Settings
MIN_FILE_SIZE_BYTES=10240
MAX_FILE_SIZE_BYTES=524288000
VALID_EXTENSIONS=.mp3,.wav,.flac,.ogg,.m4a,.aac,.opus
HASH_ALGORITHM=md5
MAX_RETRY_COUNT=3
ENABLE_RECURSIVE_SCAN=true
ENABLE_DETAILED_LOGGING=true

# =============================================================================
# ANALYSIS CONFIGURATION
# =============================================================================
ANALYSIS_MODE=smart
ANALYSIS_TIMEOUT_SECONDS=300
ANALYSIS_RETRY_ATTEMPTS=3
ANALYSIS_RETRY_DELAY_SECONDS=5
ANALYSIS_CACHE_ENABLED=true
ANALYSIS_CACHE_EXPIRY_HOURS=24
ANALYSIS_PROGRESS_REPORTING=true
ANALYSIS_STATISTICS_COLLECTION=true
ANALYSIS_CLEANUP_ENABLED=true
PROGRESS_BAR_ENABLED=true
PROGRESS_BAR_SHOW_PERCENTAGE=true
PROGRESS_BAR_SHOW_TIME_ELAPSED=true
PROGRESS_BAR_SHOW_CURRENT_FILE=true

# Streaming Audio Configuration
STREAMING_AUDIO_ENABLED=true
STREAMING_MEMORY_LIMIT_PERCENT=30
STREAMING_CHUNK_DURATION_SECONDS=30
STREAMING_LARGE_FILE_THRESHOLD_MB=2000

EXTRACT_MUSICNN=true
MUSICNN_MODEL_PATH=/app/models/msd-musicnn-1.pb
MUSICNN_JSON_PATH=/app/models/msd-musicnn-1.json
MUSICNN_TIMEOUT_SECONDS=60

# Streaming Key Extraction Configuration
STREAMING_KEY_EXTRACTION_ENABLED=true
STREAMING_KEY_CHUNK_DURATION_SECONDS=60
STREAMING_KEY_MEMORY_LIMIT_PERCENT=20
STREAMING_KEY_FILE_SIZE_THRESHOLD_MB=50
STREAMING_KEY_DURATION_THRESHOLD_MINUTES=15
STREAMING_KEY_TIMEOUT_SECONDS=600

# Long Audio Track Configuration
LONG_AUDIO_ENABLED=true
LONG_AUDIO_DURATION_THRESHOLD_MINUTES=20
LONG_AUDIO_SIMPLIFIED_FEATURES=false
LONG_AUDIO_CATEGORIES=long_mix,podcast,radio,compilation,classical,jazz
LONG_AUDIO_SKIP_DETAILED_ANALYSIS=false
LONG_AUDIO_EXTRACT_BASIC_FEATURES=true

# Large File Handling Configuration
MAX_AUDIO_FILE_SIZE_MB=2000
LARGE_FILE_WARNING_THRESHOLD_MB=100
SKIP_LARGE_FILES=false
BIG_FILE_SIZE_MB=200  # Files > 200MB use sequential processing
PARALLEL_MAX_FILE_SIZE_MB=200  # Files > 200MB use sequential
PARALLEL_MIN_FILE_SIZE_MB=100  # Files 100-200MB use parallel with half-track
HALF_TRACK_DURATION_THRESHOLD_MINUTES=60  # Use half-track for files > 60min
HALF_TRACK_THRESHOLD_MB=100  # Use half-track for files > 100MB

# MusicNN Specific Configuration
MUSICNN_MAX_FILE_SIZE_MB=200  # Allow files up to 200MB (will use half-track loading for larger ones)
MUSICNN_MIN_MEMORY_GB=2       # Reduced from 3GB to allow more processing
MUSICNN_MAX_CPU_PERCENT=80    # Increased from 70% to allow more processing
MUSICNN_BATCH_SIZE=1
MUSICNN_SAMPLE_RATE=16000
MUSICNN_HOP_SIZE=512
MUSICNN_FRAME_SIZE=2048
MUSICNN_MIN_DURATION_SECONDS=29
MUSICNN_MAX_DURATION_SECONDS=60
MUSICNN_EMBEDDING_SIZE=200
MUSICNN_TAG_COUNT=50
MUSICNN_CONFIDENCE_THRESHOLD=0.1
MUSICNN_TOP_TAGS_COUNT=10
MUSICNN_EMBEDDING_NORMALIZATION=true
MUSICNN_TAG_NORMALIZATION=true
MUSICNN_FEATURE_CACHING=true
MUSICNN_CACHE_EXPIRY_HOURS=24
MUSICNN_ERROR_RETRY_COUNT=3
MUSICNN_ERROR_RETRY_DELAY_SECONDS=5
MUSICNN_MEMORY_OPTIMIZATION=true
MUSICNN_HALF_TRACK_THRESHOLD_MB=25  # Use half-track loading for files > 25MB

# Failed Files Configuration
INCLUDE_FAILED_FILES=false
FAILED_FILES_MAX_RETRIES=3
FAILED_FILES_RETRY_DELAY_HOURS=24
FAILED_FILES_DIR=/music/failed
FAILED_FILES_FINAL_RETRY=true
FAILED_FILES_MOVE_TO_FAILED_DIR=true
MAX_FULL_ANALYSIS_SIZE_MB=25
MIN_FULL_ANALYSIS_SIZE_MB=1
MIN_MEMORY_FOR_FULL_ANALYSIS_GB=2
MEMORY_BUFFER_GB=1
MAX_CPU_FOR_FULL_ANALYSIS_PERCENT=80
CPU_CHECK_INTERVAL_SECONDS=5
PARALLEL_MAX_FILE_SIZE_MB=100
PARALLEL_MIN_MEMORY_GB=4
PARALLEL_MAX_CPU_PERCENT=90
SEQUENTIAL_MAX_FILE_SIZE_MB=2000
SEQUENTIAL_MIN_MEMORY_GB=2
SEQUENTIAL_MAX_CPU_PERCENT=70
SMART_ANALYSIS_ENABLED=true
ANALYSIS_TYPE_FALLBACK=sequential
RESOURCE_MONITORING_ENABLED=true

# =============================================================================
# RESOURCE MANAGEMENT CONFIGURATION
# =============================================================================
MEMORY_LIMIT_GB=6.0
# Container/Environment Memory Limit (overrides host memory detection)
# Set this to your container's memory limit (e.g., "4GB", "2.5GB", "512MB")
# Leave empty to use host memory detection
CONTAINER_MEMORY_LIMIT_GB=6GB
CPU_THRESHOLD_PERCENT=90
DISK_THRESHOLD_PERCENT=85
MONITORING_INTERVAL_SECONDS=5
MEMORY_PER_WORKER_GB=1.5
MAX_WORKERS=0
WORKER_TIMEOUT_SECONDS=1800
RESOURCE_MONITORING_ENABLED=true
MEMORY_CLEANUP_ENABLED=true
CPU_THROTTLING_ENABLED=true
DISK_CLEANUP_ENABLED=true
RESOURCE_HISTORY_SIZE=1000
RESOURCE_STATISTICS_COLLECTION=true
RESOURCE_ALERT_THRESHOLD_PERCENT=90
RESOURCE_AUTO_CLEANUP_ENABLED=true
RESOURCE_CALLBACK_ENABLED=true
RESOURCE_LOG_LEVEL=INFO
RESOURCE_PERFORMANCE_MONITORING=true
RESOURCE_MEMORY_LIMIT_GB=6.0
RESOURCE_CPU_LIMIT_PERCENT=90

# =============================================================================
# MULTI-SEGMENT AUDIO LOADING CONFIGURATION
# =============================================================================
# Multi-segment loading threshold (aligned with MusicNN threshold)
HALF_TRACK_THRESHOLD_MB=25
MIN_MEMORY_FOR_HALF_TRACK_GB=1.0

# Multi-segment extraction configuration (3x30s from different parts of track)
OPTIMIZED_SEGMENT_DURATION_SECONDS=30
MULTI_SEGMENT_POSITIONS=0.0,0.5,0.9
MULTI_SEGMENT_COUNT=3
HALF_TRACK_DURATION_THRESHOLD_MINUTES=30

# Extremely large file threshold (duration-based)
EXTREMELY_LARGE_DURATION_THRESHOLD_MINUTES=720

# Streaming threshold (duration-based)
STREAMING_DURATION_THRESHOLD_MINUTES=180

# =============================================================================
# VERY LARGE FILE PROCESSING CONFIGURATION
# =============================================================================
# Threshold for very large files (use aggressive sampling)
VERY_LARGE_FILE_THRESHOLD_MB=200
# Sample duration for very large files (seconds)
VERY_LARGE_FILE_SAMPLE_DURATION_SECONDS=30
# Sample duration for large files (seconds)
LARGE_FILE_SAMPLE_DURATION_SECONDS=60
# Additional timeout for very large files (seconds)
VERY_LARGE_FILE_TIMEOUT_SECONDS=1200
# Skip MusicNN for very large files (use lightweight categorization)
SKIP_MUSICNN_FOR_VERY_LARGE_FILES=true
# Enable lightweight categorization for very large files
ENABLE_LIGHTWEIGHT_CATEGORIZATION=true

# =============================================================================
# PLAYLIST GENERATION CONFIGURATION
# =============================================================================
DEFAULT_PLAYLIST_SIZE=20
MIN_TRACKS_PER_GENRE=10
MAX_PLAYLISTS=8
SIMILARITY_THRESHOLD=0.7
DIVERSITY_THRESHOLD=0.3
PLAYLIST_OUTPUT_DIR=playlists
PLAYLIST_GENERATION_ENABLED=true
PLAYLIST_SAVE_METADATA=true
PLAYLIST_OPTIMIZATION_ENABLED=true
PLAYLIST_DEFAULT_METHOD=all
PLAYLIST_KMEANS_CLUSTERS=5
PLAYLIST_SIMILARITY_ALGORITHM=cosine
PLAYLIST_TIME_SLOTS=morning,afternoon,evening,night
PLAYLIST_TAG_PRIORITY=genre,artist,album
PLAYLIST_CACHE_ENABLED=true
PLAYLIST_FEATURE_GROUPS=tempo,energy,mood
PLAYLIST_MIXED_WEIGHTS=kmeans:0.4,similarity:0.3,random:0.3 

# Audio file size thresholds (realistic for actual music files)
LARGE_FILE_WARNING_THRESHOLD_MB=100
MAX_AUDIO_FILE_SIZE_MB=500
STREAMING_LARGE_FILE_THRESHOLD_MB=200

# Duration thresholds (realistic for actual music)
LONG_AUDIO_DURATION_THRESHOLD_MINUTES=45
EXTREMELY_LARGE_SAMPLES_THRESHOLD=2000000000

# Audio type duration thresholds
RADIO_DURATION_MINUTES=90
LONG_MIX_DURATION_MINUTES=45
MIX_DURATION_MINUTES=20 

# 3x30s sample configuration for long audio categorization (optimized for accuracy)
CATEGORIZATION_SAMPLE_DURATION_SECONDS=30
CATEGORIZATION_SAMPLE_COUNT=3 